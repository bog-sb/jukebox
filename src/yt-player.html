<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/paper-search/paper-search.html">
<link rel="import" href="../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">

<dom-module id="yt-player">
    <!-- Defines the element's style and local DOM -->
    <template>
        <style>
            :host {
                display: block;

                padding: 16px;
            }

            .result {
                width: 100%;
                height: 30px;
                border: 1px solid darkgreen;
                position: relative;
            }

            .current {
                background: transparent;
            }

            .thumbnail {
                float: left;
                max-height: 100%;
                max-width: 30%;
            }

            .title {
                float: left;
                max-width: 70%;
            }

            .player {
                border: 2px solid green;
                height: 400px;
                width: 80%;
                margin: 0 auto;
            }

            .result-container {
                border: 2px solid turquoise;
                height: 160px;
                width: 80%;
                margin: 0 auto;
                overflow: scroll;
            }

            .footer {
                border: 2px solid magenta;
                height: 100%;
                width: 80%;
                margin: 0 auto;
            }

            .play {
                position: absolute;
                bottom: 30px;
                right: 30px;
            }
        </style>

        <h1>Hi! Welcome to our awesome jukebox. Start adding songs!</h1>

        <div class="player">

        </div>

        <div class="result-container">
            <template is="dom-repeat" items="{{items}}">
                <div class="result" on-tap="songTapped">
                    <paper-ripple></paper-ripple>
                    <img src="{{item.snippet.thumbnails.default.url}}" class="thumbnail">

                    <div class="title">
                        {{item.snippet.title}}
                    </div>
                </div>
            </template>
        </div>

        <div class="footer">
            Join the party at: jukebox.com/1A
        </div>

        <paper-fab icon="menu" class="play" on-tap="togglePlay"></paper-fab>


    </template>
    <!-- Creates the element's prototype and registers it -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        Polymer({
            is: 'yt-player',
            listeners: {
                'paper-search-search': 'doSearch'
            },
            togglePlay: function (event) {
                console.log('toggle play');
                //toggle icon

                //pause/resume
            },
            songTapped: function(event){
                console.log('song tapped '+event.model.get('item'))


            },
            handleTap: function (event) {
                console.log(event.model.get('item.id.videoId'))
            },
            doSearch: function () {
                var query = this.search && this.search.length > 0 ? this.search : 'asd' //TODO: delete after dev is done
                var me = this;
                gapi.client.youtube.search.list({
                    q: query,
                    part: 'snippet',
                    type: 'video',
                    videoEmbeddable: true
                }).then(function (resp) {
                    console.log(resp.result.items.map(function (e) {
                        return e.snippet.title
                    }));
                    me.items = resp.result.items;
                }, function (reason) {
                    console.log('Error: ' + reason.result.error.message);
                });
            },

            ready: function () {
                var me = this;
                var initYoutubeApi = function () {
                    var api = gapi.client.init({
                        'apiKey': 'AIzaSyBg5MQf7SBF56caD8x2K3-Zhw7nX9686fk',
                        'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest'],
                    }).then(function () {
                        me.doSearch()
                    });
                }
//                gapi.load('client', initYoutubeApi);
                this.items = [1,2,3,4,5,6,7]
            }
        })
        ;

        var initYoutubeApi = function () {
            var api = gapi.client.init({
                'apiKey': 'AIzaSyBg5MQf7SBF56caD8x2K3-Zhw7nX9686fk',
                'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest'],
            });
        }
        gapi.load('client', initYoutubeApi);
    </script>
</dom-module>
