<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<dom-module id="main-menu">
    <!-- Defines the element's style and local DOM -->
    <template>
        <style>
            :host {
                display: block;
                padding: 16px;
            }

            paper-button.center{
                margin:0 auto;
                background-color: var(--app-button-color);
            }

            /*paper-button {*/
                /*background-color: var(--app-button-color);*/
            /*}*/
        </style>

        <div class="container"></div>
        <h1>Welcome</h1>

        <paper-button fill="true" class="center">Create a jukebox</paper-button>

        <h2> OR </h2>

        <paper-button fill="true" class="center"></paper-button>

        <template is="dom-repeat" items="{{items}}">

                <div class="title">
                    {{item.snippet.title}}
                </div>

                <!--<a href="google.com" target="_blank">-->
                <!--<paper-icon-button icon="more-vert" fill="true">-->
                    <!--&lt;!&ndash;<iron-icon icon="favorite">asd</iron-icon>&ndash;&gt;-->
                <!--</paper-icon-button>-->

                <paper-fab label="+" on-tap="handleTap"></paper-fab>
                <!--</a>-->
            </div>
        </template>


    </template>
    <!-- Creates the element's prototype and registers it -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        Polymer({
            is: 'main-menu',
            listeners: {
                'paper-search-search': 'doSearch'
            },
            handleTap: function(event){
                console.log(event.model.get('item.id.videoId'))
            },
            doSearch: function () {
                var query = this.search && this.search.length > 0 ? this.search : 'asd' //TODO: delete after dev is done
                var me = this;
                gapi.client.youtube.search.list({
                    q: query,
                    part: 'snippet',
                    type: 'video',
                    videoEmbeddable: true
                }).then(function (resp) {
                    console.log(resp.result.items.map(function (e) {
                        return e.snippet.title
                    }));
                    me.items = resp.result.items;
                }, function (reason) {
                    console.log('Error: ' + reason.result.error.message);
                });
            },

            ready: function () {
                var me = this;
                var initYoutubeApi = function () {
                    var api = gapi.client.init({
                        'apiKey': 'AIzaSyBg5MQf7SBF56caD8x2K3-Zhw7nX9686fk',
                        'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest'],
                    }).then(function () {
                        me.doSearch()
                    });
                }
                gapi.load('client', initYoutubeApi);
            }
        })
        ;

        var initYoutubeApi = function () {
            var api = gapi.client.init({
                'apiKey': 'AIzaSyBg5MQf7SBF56caD8x2K3-Zhw7nX9686fk',
                'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest'],
            });
        }
        gapi.load('client', initYoutubeApi);
    </script>
</dom-module>
